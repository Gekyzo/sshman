# sshman Shell Completion

This directory contains shell completion scripts for `sshman` that enable tab completion for commands and SSH key names.

## Features

- **Tab completion for commands**: `sshman [TAB]` shows available commands
- **Tab completion for key names**: `sshman use [TAB]` lists available SSH keys
- **Works with nested keys**: Supports keys in subdirectories under `~/.ssh`
- **Dynamic completion**: Automatically detects private keys in your SSH directory

## Installation

### Quick Install (Recommended)

Run the installation script to automatically set up completion for your shell:

```bash
cd completions
./install.sh
```

The script automatically detects your shell and platform:
- **macOS**: Supports Homebrew zsh completion directory (`/opt/homebrew/share/zsh/site-functions`)
- **Linux/Unix**: Uses standard completion directories
- **Auto-detection**: Uses `$SHELL` environment variable for shell detection

Then restart your shell or source your shell configuration:
```bash
# For bash
source ~/.bashrc

# For zsh
source ~/.zshrc
```

### Manual Installation

#### Bash

1. **System-wide installation** (requires sudo):
   ```bash
   sudo cp sshman_completion.bash /etc/bash_completion.d/sshman
   ```

2. **User installation**:
   ```bash
   mkdir -p ~/.bash_completion.d
   cp sshman_completion.bash ~/.bash_completion.d/
   echo '[ -f ~/.bash_completion.d/sshman_completion.bash ] && source ~/.bash_completion.d/sshman_completion.bash' >> ~/.bashrc
   source ~/.bashrc
   ```

#### Zsh

1. **System-wide installation** (requires sudo):
   ```bash
   # Standard location
   sudo cp _sshman /usr/local/share/zsh/site-functions/

   # Or for Homebrew on macOS
   sudo cp _sshman /opt/homebrew/share/zsh/site-functions/
   ```

2. **User installation**:
   ```bash
   mkdir -p ~/.zsh/completion
   cp _sshman ~/.zsh/completion/
   echo 'fpath=(~/.zsh/completion $fpath)' >> ~/.zshrc
   echo 'autoload -Uz compinit && compinit' >> ~/.zshrc
   source ~/.zshrc
   ```

## Usage Examples

Once installed, you can use tab completion:

```bash
# Complete command names
./sshman [TAB]
# Shows: generate  help  info  list  use

# Complete key names for 'use' command
./sshman use [TAB]
# Shows: id_ed25519  id_rsa  work/github_key  ...

# Complete key names for 'info' command
./sshman info [TAB]
# Shows: id_ed25519  id_rsa  work/github_key  ...

# Complete options
./sshman use --[TAB]
# Shows: --help  --path  --quiet  --time  --version
```

## How It Works

The completion scripts:
1. Scan your `~/.ssh` directory (or custom path specified with `--path`)
2. Filter out non-key files (`.pub`, `config`, `known_hosts`, `authorized_keys`)
3. Verify files are valid private keys by checking for the "-----BEGIN" header
4. Present matching key names as completion candidates

## Troubleshooting

### Completion not working after installation

1. Make sure you've restarted your shell or sourced the configuration file
2. For bash, verify bash-completion is installed: `apt-get install bash-completion` (Ubuntu/Debian)
3. Check that the completion script is being sourced: `type _sshman` (should show a function)

### Keys not showing up in completion

1. Verify keys are in `~/.ssh` or use `--path` to specify custom location
2. Check that key files are valid private keys (start with `-----BEGIN`)
3. Ensure key files are readable (check permissions)

### Zsh completion not working

1. Make sure `compinit` is called after adding the completion directory to `fpath`
2. Try rebuilding the completion cache: `rm -f ~/.zcompdump && compinit`
3. Check `fpath` contains the completion directory: `echo $fpath`

## Regenerating Completion Scripts

If you modify the sshman commands or options, regenerate the completion scripts:

```bash
# For bash (requires built JAR)
java -cp target/sshman-0.1.0-jar-with-dependencies.jar \
  picocli.AutoComplete com.sshman.SshMan \
  -n sshman -o completions/sshman_completion.bash -f

# For zsh, update completions/_sshman manually or use a generator
```

## Files

- `sshman_completion.bash` - Bash completion script (auto-generated by picocli)
- `_sshman` - Zsh completion script
- `install.sh` - Automated installation script
- `README.md` - This file

## Supported Shells

- ✅ Bash 4.0+
- ✅ Zsh 5.0+
- ❌ Fish (not yet supported)

## Contributing

To improve completion support:
1. Test the completion with your shell configuration
2. Report issues with specific shell versions or configurations
3. Submit pull requests with enhancements

For Fish shell support, contributions are welcome!
